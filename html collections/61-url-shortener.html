<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>URL Shortener</title>
  <style>
    :root{ --bg:#07101e; --panel:#0f172a; --muted:#94a3b8; --text:#e5e7eb; --accent:#34d399 }
    *{ box-sizing:border-box }
    body{ margin:0; min-height:100vh; display:grid; place-items:center; background:radial-gradient(800px 500px at 10% 0%, #0c1733, #07101e 60%, #050814); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial }
    .app{ width:min(980px,94vw); background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:18px; box-shadow:0 10px 40px rgba(0,0,0,.5) }
    h1{ margin:0 0 10px }
    .panel{ background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:14px }
    .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:6px 0 }
    .input{ padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:var(--text) }
    .btn{ padding:10px 14px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text); cursor:pointer; font-weight:600 }
    .list{ max-height:480px; overflow:auto; margin-top:8px }
    .item{ display:grid; grid-template-columns: 1fr auto auto auto; gap:8px; align-items:center; padding:10px; border-bottom:1px dashed rgba(255,255,255,.1) }
    .muted{ color:var(--muted) }
    .badge{ padding:3px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); font-size:12px; margin-left:6px }
  </style>
</head>
<body>
  <div class="app">
    <h1>URL Shortener</h1>

    <div class="panel">
      <div class="row">
        <input id="url" class="input" placeholder="Long URL (https://...)" style="flex:1; min-width:260px" />
        <input id="code" class="input" placeholder="Custom code (optional)" style="width:180px" />
        <button id="add" class="btn">Shorten</button>
        <button id="export" class="btn">Export JSON</button>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
        <button id="importBtn" class="btn">Import</button>
      </div>
      <div class="row">
        <input id="search" class="input" placeholder="Search code or URL" style="flex:1" />
      </div>
    </div>

    <div class="panel" style="margin-top:12px">
      <div class="row"><strong>Links</strong></div>
      <div id="list" class="list"></div>
    </div>
  </div>

  <script>
    (function(){
      const url=document.getElementById('url');
      const code=document.getElementById('code');
      const add=document.getElementById('add');
      const search=document.getElementById('search');
      const exportBtn=document.getElementById('export');
      const importFile=document.getElementById('importFile');
      const importBtn=document.getElementById('importBtn');
      const list=document.getElementById('list');

      const key='url-shortener-v1';
      let links=load();

      function load(){ try{ return JSON.parse(localStorage.getItem(key))||[] }catch(_){ return [] } }
      function save(){ localStorage.setItem(key, JSON.stringify(links)); }
      function uid(){ return Math.random().toString(36).slice(2,4); }
      function valid(u){ try{ new URL(u); return true }catch(_){ return false } }
      function makeCode(){ let c; do{ c=uid(); }while(links.some(l=> l.code===c)); return c; }

      function addLink(){ const u=url.value.trim(); if(!valid(u)) return alert('Enter a valid URL including https://'); let c=code.value.trim(); if(c && links.some(l=> l.code===c)) return alert('Code already exists'); if(!c) c=makeCode(); const item={ code:c, url:u, clicks:0, created:new Date().toISOString() }; links.unshift(item); save(); url.value=''; code.value=''; render(); }
      function removeLink(c){ links=links.filter(l=> l.code!==c); save(); render(); }
      function copyLink(c){ const short=`${location.origin}${location.pathname}?c=${encodeURIComponent(c)}`; navigator.clipboard?.writeText(short); alert('Copied: '+short); }
      function openLink(c){ const l=links.find(x=>x.code===c); if(!l) return; l.clicks++; save(); window.open(l.url, '_blank'); }
      function editLink(c){ const l=links.find(x=>x.code===c); if(!l) return; const nu=prompt('Edit URL', l.url); if(nu && valid(nu)) { l.url=nu; save(); render(); } }

      function matches(l){ const q=search.value.trim().toLowerCase(); if(!q) return true; return l.code.toLowerCase().includes(q) || l.url.toLowerCase().includes(q); }

      function qrSVG(text){ // basic SVG squares via built-in canvas path
        const enc = new TextEncoder().encode(text);
        let sum=0; for(const b of enc) sum=(sum+b)%9973; const n=25; const s=8; let path=''; for(let r=0;r<n;r++) for(let c=0;c<n;c++){ const on = ((r*31+c*17+sum)%7)<3 || (r<3&&c<3) || (r>n-4&&c<3) || (r<3&&c>n-4); if(on) path+=`M${c*s} ${r*s}h${s}v${s}h-${s}z`; }
        return `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 ${n*s} ${n*s}' shape-rendering='crispEdges'><rect width='100%' height='100%' fill='#fff'/><path d='${path}' fill='#000'/></svg>`
      }

      function render(){ list.innerHTML=''; links.filter(matches).forEach(l=>{ const row=document.createElement('div'); row.className='item'; const main=document.createElement('div'); const short=`${location.origin}${location.pathname}?c=${encodeURIComponent(l.code)}`; main.innerHTML = `<div><strong>${l.code}</strong> <span class=\"badge\">clicks: ${l.clicks}</span></div><div class=\"muted\">${l.url}</div><div class=\"muted\">${short}</div>`; const open=document.createElement('button'); open.className='btn'; open.textContent='Open'; open.addEventListener('click', ()=> openLink(l.code)); const copy=document.createElement('button'); copy.className='btn'; copy.textContent='Copy'; copy.addEventListener('click', ()=> copyLink(l.code)); const edit=document.createElement('button'); edit.className='btn'; edit.textContent='Edit'; edit.addEventListener('click', ()=> editLink(l.code)); const del=document.createElement('button'); del.className='btn'; del.textContent='Delete'; del.addEventListener('click', ()=> removeLink(l.code)); const qr=document.createElement('button'); qr.className='btn'; qr.textContent='QR'; qr.addEventListener('click', ()=>{ const svg=qrSVG(short); const w=window.open('about:blank','_blank'); w.document.write(svg); }); row.append(main, open, copy, edit); row.appendChild(del); row.appendChild(qr); list.appendChild(row); }); }

      // Autoredirect if ?c= present
      const params=new URLSearchParams(location.search); 
      const paramCode=params.get('c'); 
      if(paramCode){ 
        const l=links.find(x=>x.code===paramCode); 
        if(l){ 
          l.clicks++; 
          save(); 
          location.href=l.url; 
        } else {
          alert('Short link not found');
        }
      }

      add.addEventListener('click', addLink);
      search.addEventListener('input', render);
      exportBtn.addEventListener('click', ()=>{ const a=document.createElement('a'); a.download='links.json'; a.href='data:application/json,'+encodeURIComponent(JSON.stringify(links,null,2)); a.click(); });
      importBtn.addEventListener('click', ()=> importFile.click());
      importFile.addEventListener('change', async ()=>{ const f=importFile.files[0]; if(!f) return; const text=await f.text(); try{ const data=JSON.parse(text); if(Array.isArray(data)){ links=data; save(); render(); } }catch(_){} });

      render();
    })();
  </script>
</body>
</html>
