<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather Widget</title>
  <style>
    :root{ --bg:#06101f; --panel:#0f172a; --muted:#94a3b8; --text:#e5e7eb; --accent:#38bdf8; --ok:#22c55e }
    *{ box-sizing:border-box }
    body{ margin:0; min-height:100vh; display:grid; place-items:center; background:radial-gradient(800px 500px at 10% 0%, #0c1733, #06101f 60%, #050814); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial }
    .app{ width:min(980px,94vw); background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:18px; box-shadow:0 10px 40px rgba(0,0,0,.5) }
    h1{ margin:0 0 10px; font-size:28px }
    .panel{ background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:14px }
    .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:6px 0 }
    .input{ padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:var(--text) }
    .btn{ padding:10px 14px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text); cursor:pointer; font-weight:600 }
    .muted{ color:var(--muted) }

    .grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap:12px }
    .current{ display:grid; grid-template-columns: auto 1fr auto; gap:12px; align-items:center }
    .temp{ font-size:48px; font-weight:700 }
    .city{ font-size:18px }
    .tile{ background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px }
    .forecast{ display:grid; grid-template-columns: repeat(7,1fr); gap:8px }
    .day{ text-align:center; padding:10px; border-radius:12px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08) }
    .big{ font-size:22px; font-weight:700 }
    .pair{ display:grid; grid-template-columns: 1fr 1fr; gap:8px }
  </style>
</head>
<body>
  <div class="app">
    <h1>Weather</h1>

    <div class="panel">
      <div class="row">
        <input id="q" class="input" placeholder="Search city (e.g., Chennai)" style="flex:1; min-width:220px" />
        <button id="search" class="btn">Search</button>
        <button id="geo" class="btn">Use My Location</button>
        <select id="unit" class="input"><option value="C">°C</option><option value="F">°F</option></select>
      </div>
      <div id="status" class="muted" style="min-height:20px"></div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="panel">
        <div class="current">
          <div class="temp" id="temp">--</div>
          <div>
            <div class="city" id="city">—</div>
            <div class="muted" id="desc">—</div>
          </div>
          <div class="tile pair">
            <div>
              <div class="muted">Wind</div>
              <div id="wind">--</div>
            </div>
            <div>
              <div class="muted">Humidity</div>
              <div id="humid">--</div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="muted" style="margin-bottom:6px">7‑day Forecast</div>
        <div id="forecast" class="forecast"></div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const q=document.getElementById('q');
      const search=document.getElementById('search');
      const geo=document.getElementById('geo');
      const unit=document.getElementById('unit');
      const statusEl=document.getElementById('status');
      const cityEl=document.getElementById('city');
      const descEl=document.getElementById('desc');
      const tempEl=document.getElementById('temp');
      const windEl=document.getElementById('wind');
      const humidEl=document.getElementById('humid');
      const forecastEl=document.getElementById('forecast');

      const key='weather-widget-v1';
      let state = load() || { name:'', lat:null, lon:null, unit:'C' };

      function load(){ try{ return JSON.parse(localStorage.getItem(key)) }catch(_){ return null } }
      function save(){ localStorage.setItem(key, JSON.stringify(state)); }

      unit.value = state.unit || 'C';

      async function geocode(city){
        const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=en&format=json`;
        const res = await fetch(url); if(!res.ok) throw new Error('geocode failed'); const data=await res.json();
        if(!data.results || !data.results.length) throw new Error('city not found');
        const r=data.results[0]; return { name:`${r.name}${r.admin1?`, ${r.admin1}`:''}, ${r.country_code}`, lat:r.latitude, lon:r.longitude };
      }

      function iconFor(code){
        const map={0:'Clear',1:'Mainly clear',2:'Partly cloudy',3:'Cloudy',45:'Fog',48:'Rime fog',51:'Drizzle',61:'Rain',71:'Snow',80:'Showers',95:'Thunderstorm'}; return map[code]||'Weather';
      }

      async function fetchWeather(lat,lon){
        const metric = unit.value==='C';
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,weather_code&hourly=relative_humidity_2m&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto${metric?'&temperature_unit=celsius&wind_speed_unit=kmh':'&temperature_unit=fahrenheit&wind_speed_unit=mph'}`;
        const res = await fetch(url); if(!res.ok) throw new Error('forecast failed'); return res.json();
      }

      function setStatus(msg){ statusEl.textContent=msg||''; }
      function toUnitTemp(v){ return unit.value==='C'? `${Math.round(v)}°C` : `${Math.round(v)}°F`; }
      function toUnitSpeed(v){ return unit.value==='C'? `${Math.round(v)} km/h` : `${Math.round(v)} mph`; }

      async function showCity(city){ try{ setStatus('Loading...'); const loc=await geocode(city); state={...state, ...loc}; save(); await showWeather(); } catch(e){ setStatus(e.message||'Failed'); } }

      async function showWeather(){ if(state.lat==null||state.lon==null){ setStatus('Pick a city or use your location'); return; } try{ setStatus('Loading weather...'); const data=await fetchWeather(state.lat,state.lon); renderCurrent(data); renderForecast(data); cityEl.textContent = state.name||'—'; setStatus(''); } catch(e){ setStatus('Failed to load weather'); } }

      function renderCurrent(data){
        const c=data.current; tempEl.textContent = toUnitTemp(c.temperature_2m); descEl.textContent=iconFor(c.weather_code); windEl.textContent=toUnitSpeed(c.wind_speed_10m);
        const hum = (data.hourly && data.hourly.relative_humidity_2m && data.hourly.relative_humidity_2m[0]) || c.relative_humidity_2m || 0; humidEl.textContent = hum+"%";
      }

      function renderForecast(data){ forecastEl.innerHTML=''; const days=data.daily; if(!days || !days.time) return; const fmt = (d)=> new Date(d).toLocaleDateString(undefined,{weekday:'short'});
        for(let i=0;i<Math.min(7, days.time.length); i++){
          const el=document.createElement('div'); el.className='day'; const hi=toUnitTemp(days.temperature_2m_max[i]); const lo=toUnitTemp(days.temperature_2m_min[i]); el.innerHTML = `<div class=\"muted\">${fmt(days.time[i])}</div><div class=\"big\">${hi}</div><div>${lo}</div><div class=\"muted\">${iconFor(days.weather_code[i])}</div>`; forecastEl.appendChild(el);
        }
      }

      search.addEventListener('click', ()=>{ const v=q.value.trim(); if(v) showCity(v); });
      unit.addEventListener('change', ()=>{ state.unit=unit.value; save(); showWeather(); });
      geo.addEventListener('click', ()=>{ if(!navigator.geolocation){ setStatus('Geolocation not supported'); return; } setStatus('Getting location...'); navigator.geolocation.getCurrentPosition(async pos=>{ state.lat=pos.coords.latitude; state.lon=pos.coords.longitude; state.name='My Location'; save(); await showWeather(); }, _=> setStatus('Location denied')) });

      if(state.lat!=null && state.lon!=null){ showWeather(); }
    })();
  </script>
</body>
</html>
