<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Habit Tracker</title>
  <style>
    :root{ --bg:#070e1e; --panel:#0f172a; --muted:#94a3b8; --text:#e5e7eb; --accent:#38bdf8; --ok:#22c55e; --warn:#f59e0b }
    *{ box-sizing:border-box }
    body{ margin:0; min-height:100vh; display:grid; place-items:center; background:radial-gradient(800px 500px at 10% 0%, #0c1733, #070e1e 60%, #050814); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial }
    .app{ width:min(1000px,94vw); background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:18px; box-shadow:0 10px 40px rgba(0,0,0,.5) }
    h1{ margin:0 0 10px; font-size:28px }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px }
    .panel{ background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:14px }
    .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:6px 0 }
    .input{ padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:var(--text) }
    .btn{ padding:10px 14px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text); cursor:pointer; font-weight:600 }
    .muted{ color:var(--muted) }

    .calendar{ display:grid; grid-template-columns: repeat(7,1fr); gap:8px; margin-top:10px }
    .day{ height:38px; display:grid; place-items:center; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); cursor:pointer; user-select:none; font-size:12px }
    .day.dim{ opacity:.35 }
    .day.done{ background:rgba(34,197,94,.18); border-color:rgba(34,197,94,.5) }
    .weekday{ text-align:center; font-size:12px; color:var(--muted) }

    .list{ max-height:480px; overflow:auto; margin-top:8px }
    .item{ display:grid; grid-template-columns: 1fr auto auto; gap:8px; align-items:center; padding:10px; border-bottom:1px dashed rgba(255,255,255,.1) }
    .badge{ padding:3px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); font-size:12px; margin-left:6px }
  </style>
</head>
<body>
  <div class="app">
    <h1>Habit Tracker</h1>

    <div class="grid">
      <div class="panel">
        <div class="row">
          <input id="name" class="input" placeholder="Habit name (e.g., Read 20 mins)" style="flex:1; min-width:240px" />
          <select id="freq" class="input">
            <option value="daily" selected>Daily</option>
            <option value="weekly">Weekly (pick weekdays)</option>
          </select>
          <input id="weekdays" class="input" placeholder="Weekdays (e.g., Mon,Wed,Fri)" style="min-width:160px" />
          <button id="add" class="btn">Add</button>
        </div>
        <div class="row">
          <input id="search" class="input" placeholder="Search habits" style="flex:1" />
          <button id="export" class="btn">Export JSON</button>
          <input id="importFile" type="file" accept="application/json" style="display:none" />
          <button id="importBtn" class="btn">Import</button>
        </div>
        <div class="row" style="justify-content:space-between; align-items:center">
          <div>
            <button id="prev" class="btn">◀</button>
            <span id="monthLabel" style="margin:0 8px"></span>
            <button id="next" class="btn">▶</button>
          </div>
          <div class="muted">Click a day to toggle completion for the selected habit</div>
        </div>
        <div class="row"><strong id="selectedTitle">No habit selected</strong></div>
        <div class="calendar" id="weekHeader"></div>
        <div class="calendar" id="calendar"></div>
      </div>

      <div class="panel">
        <div class="row"><strong>Habits</strong></div>
        <div id="list" class="list"></div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const name=document.getElementById('name');
      const freq=document.getElementById('freq');
      const weekdays=document.getElementById('weekdays');
      const add=document.getElementById('add');
      const search=document.getElementById('search');
      const exportBtn=document.getElementById('export');
      const importFile=document.getElementById('importFile');
      const importBtn=document.getElementById('importBtn');
      const list=document.getElementById('list');
      const prev=document.getElementById('prev');
      const next=document.getElementById('next');
      const monthLabel=document.getElementById('monthLabel');
      const calendar=document.getElementById('calendar');
      const weekHeader=document.getElementById('weekHeader');
      const selectedTitle=document.getElementById('selectedTitle');

      const key='habit-tracker-v1';
      let habits=load();
      let selectedId = habits[0]?.id || null;
      let view = new Date(); view.setDate(1);

      const WEEKDAYS=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

      function load(){ try{ return JSON.parse(localStorage.getItem(key))||[] }catch(_){ return [] } }
      function save(){ localStorage.setItem(key, JSON.stringify(habits)); }
      function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,8); }

      function parseWeekdays(s){ const set=new Set((s||'').split(',').map(x=>x.trim().slice(0,3)).filter(Boolean)); return WEEKDAYS.map(d=> set.has(d)); }

      function addHabit(){ const n=name.value.trim(); if(!n) return; const h={ id:uid(), name:n, freq:freq.value, weekdays:parseWeekdays(weekdays.value), checks:{}, created:new Date().toISOString() }; habits.unshift(h); save(); name.value=''; weekdays.value=''; selectedId=h.id; render(); buildCalendar(); }
      function removeHabit(id){ habits=habits.filter(h=> h.id!==id); if(selectedId===id) selectedId = habits[0]?.id || null; save(); render(); buildCalendar(); }
      function editHabit(id){ const h=habits.find(x=>x.id===id); if(!h) return; const nn=prompt('Edit name', h.name); if(nn===null) return; const nf=prompt('Edit frequency (daily/weekly)', h.freq); const nw=prompt('Edit weekdays (Mon,Wed,...) for weekly', h.weekdays.map((v,i)=> v?WEEKDAYS[i]:'').filter(Boolean).join(',')); h.name = (nn.trim()||h.name); h.freq = (nf==='weekly'?'weekly':'daily'); h.weekdays = parseWeekdays(nw); save(); render(); buildCalendar(); }

      function matches(h){ const q=search.value.trim().toLowerCase(); if(!q) return true; return h.name.toLowerCase().includes(q); }

      function streakFor(h){ const today=new Date(); today.setHours(0,0,0,0); let d=new Date(today); let streak=0; for(let i=0;i<365;i++){ const key=dateKey(d); if(h.checks[key]){ streak++; } else { break; } d.setDate(d.getDate()-1); } return streak; }

      function render(){ list.innerHTML=''; habits.filter(matches).forEach(h=>{ const row=document.createElement('div'); row.className='item'; const main=document.createElement('div'); const st=streakFor(h); main.innerHTML = `<div><strong>${h.name}</strong> <span class=\"badge\">${h.freq}</span> <span class=\"badge\">Streak: ${st}</span></div><div class=\"muted\">Created ${new Date(h.created).toLocaleDateString()}</div>`; const selectBtn=document.createElement('button'); selectBtn.className='btn'; selectBtn.textContent = (selectedId===h.id)?'Selected':'Select'; selectBtn.addEventListener('click', ()=>{ selectedId=h.id; buildCalendar(); render(); }); const act=document.createElement('div'); const e=document.createElement('button'); e.className='btn'; e.textContent = 'Edit'; e.addEventListener('click', ()=> editHabit(h.id)); const r=document.createElement('button'); r.className='btn'; r.textContent = 'Remove'; r.addEventListener('click', ()=> removeHabit(h.id)); row.append(main, selectBtn, e); row.appendChild(r); list.appendChild(row); }); selectedTitle.textContent = selectedId? (habits.find(h=>h.id===selectedId)?.name||'') : 'No habit selected'; buildWeekHeader(); updateMonthLabel(); }

      function dateKey(d){ const y=d.getFullYear(), m=d.getMonth()+1, day=d.getDate(); return `${y}-${String(m).padStart(2,'0')}-${String(day).padStart(2,'0')}`; }
      function daysInMonth(y,m){ return new Date(y, m+1, 0).getDate(); }

      function buildWeekHeader(){ weekHeader.innerHTML=''; WEEKDAYS.forEach(w=>{ const el=document.createElement('div'); el.className='weekday'; el.textContent=w; weekHeader.appendChild(el); }); }

      function updateMonthLabel(){ const y=view.getFullYear(); const m=view.toLocaleString(undefined,{month:'long'}); monthLabel.textContent = `${m} ${y}`; }

      function buildCalendar(){ calendar.innerHTML=''; updateMonthLabel(); const h=habits.find(x=>x.id===selectedId); const y=view.getFullYear(); const m=view.getMonth(); const first=new Date(y,m,1); const startDay=first.getDay(); const total=daysInMonth(y,m); const prevFill=startDay; const cells=prevFill+total; const rows= Math.ceil(cells/7)*7; // grid
        for(let i=0;i<rows;i++){
          const cell=document.createElement('div'); cell.className='day dim';
          const dayNum=i-startDay+1;
          const inMonth = dayNum>=1 && dayNum<=total;
          if(inMonth){ cell.classList.remove('dim'); cell.textContent=String(dayNum); const d=new Date(y,m,dayNum); const k=dateKey(d);
            const isAllowed = !h || h.freq==='daily' || (h.freq==='weekly' && h.weekdays[d.getDay()]);
            if(h && h.checks[k]) cell.classList.add('done');
            cell.addEventListener('click', ()=>{
              if(!h) return; if(!isAllowed) return;
              h.checks[k] = !h.checks[k]; save(); buildCalendar(); render();
            });
          }
          calendar.appendChild(cell);
        }
      }

      function shiftMonth(delta){ view.setMonth(view.getMonth()+delta); buildCalendar(); }

      function exportJSON(){ const a=document.createElement('a'); a.download='habits.json'; a.href='data:application/json,'+encodeURIComponent(JSON.stringify(habits,null,2)); a.click(); }
      function importJSONSetup(){ importBtn.addEventListener('click', ()=> importFile.click()); importFile.addEventListener('change', async ()=>{ const f=importFile.files[0]; if(!f) return; const text=await f.text(); try{ const data=JSON.parse(text); if(Array.isArray(data)){ habits=data; save(); selectedId = habits[0]?.id || null; render(); buildCalendar(); } }catch(_){} }); }

      prev.addEventListener('click', ()=> shiftMonth(-1));
      next.addEventListener('click', ()=> shiftMonth(1));
      add.addEventListener('click', addHabit);
      search.addEventListener('input', render);
      exportBtn.addEventListener('click', exportJSON);
      importJSONSetup();

      render(); buildCalendar();
    })();
  </script>
</body>
</html>
