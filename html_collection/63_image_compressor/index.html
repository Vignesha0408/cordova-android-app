<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Compressor</title>
  <style>
    :root{ --bg:#06101f; --panel:#0f172a; --muted:#94a3b8; --text:#e5e7eb; --accent:#34d399 }
    *{ box-sizing:border-box }
    body{ margin:0; min-height:100vh; display:grid; place-items:center; background:radial-gradient(800px 500px at 10% 0%, #0c1733, #06101f 60%, #050814); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial }
    .app{ width:min(1000px,94vw); background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:18px; box-shadow:0 10px 40px rgba(0,0,0,.5) }
    h1{ margin:0 0 10px }
    .panel{ background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:14px }
    .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:6px 0 }
    .input{ padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:var(--text) }
    .btn{ padding:10px 14px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text); cursor:pointer; font-weight:600 }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px }
    .box{ background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px; min-height:260px }
    .thumb{ max-width:100%; border-radius:10px }
    .muted{ color:var(--muted) }
    .file{ padding:8px; border:1px dashed rgba(255,255,255,.25); border-radius:10px }
  </style>
</head>
<body>
  <div class="app">
    <h1>Image Compressor</h1>

    <div class="panel">
      <div class="row">
        <input id="files" class="input" type="file" accept="image/*" multiple />
        <select id="format" class="input"><option value="image/jpeg">JPEG</option><option value="image/webp" selected>WebP</option><option value="image/png">PNG</option></select>
        <label>Quality <input id="quality" class="input" type="range" min="0.1" max="1" step="0.05" value="0.8" /></label>
        <label>Max W <input id="maxW" class="input" type="number" value="1280" style="width:100px" /></label>
        <label>Max H <input id="maxH" class="input" type="number" value="1280" style="width:100px" /></label>
        <button id="process" class="btn">Compress</button>
        <button id="downloadAll" class="btn">Download All (ZIP)</button>
      </div>
      <div id="status" class="muted"></div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="box">
        <strong>Originals</strong>
        <div id="orig"></div>
      </div>
      <div class="box">
        <strong>Compressed</strong>
        <div id="comp"></div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const files=document.getElementById('files');
      const format=document.getElementById('format');
      const quality=document.getElementById('quality');
      const maxW=document.getElementById('maxW');
      const maxH=document.getElementById('maxH');
      const processBtn=document.getElementById('process');
      const downloadAll=document.getElementById('downloadAll');
      const statusEl=document.getElementById('status');
      const orig=document.getElementById('orig');
      const comp=document.getElementById('comp');

      let outputs=[];

      function setStatus(m){ statusEl.textContent=m||''; }

      function imgToCanvas(img, maxWidth, maxHeight){
        const ratio = Math.min(1, maxWidth/img.naturalWidth, maxHeight/img.naturalHeight);
        const w = Math.max(1, Math.round(img.naturalWidth*ratio));
        const h = Math.max(1, Math.round(img.naturalHeight*ratio));
        const c=document.createElement('canvas'); c.width=w; c.height=h; const g=c.getContext('2d'); g.drawImage(img,0,0,w,h); return c;
      }

      function renderFileList(listEl, files){ listEl.innerHTML=''; files.forEach(f=>{ const div=document.createElement('div'); div.className='file'; div.textContent = `${f.name} • ${Math.round(f.size/1024)} KB`; listEl.appendChild(div); }); }

      function previewOriginals(){ const arr=[...files.files]; renderFileList(orig, arr); }

      async function readImage(file){ return new Promise((res,rej)=>{ const img=new Image(); img.onload=()=>res(img); img.onerror=rej; img.src=URL.createObjectURL(file); }); }

      async function compressOne(file){ const img=await readImage(file); const c=imgToCanvas(img, Number(maxW.value), Number(maxH.value)); const blob= await new Promise(r=> c.toBlob(r, format.value, Number(quality.value))); const url=URL.createObjectURL(blob); return { name:file.name.replace(/\.[^.]+$/, ''), blob, url, size:blob.size } }

      async function compressAll(){ 
        const filesArr=[...files.files]; 
        if(!filesArr.length) {
          setStatus('Please select files first');
          return;
        } 
        setStatus('Compressing...'); 
        outputs=[]; 
        comp.innerHTML=''; 
        try {
          for(const f of filesArr){ 
            const out=await compressOne(f); 
            outputs.push(out); 
            const row=document.createElement('div'); 
            row.className='file'; 
            row.innerHTML = `${out.name} • ${Math.round(out.size/1024)} KB` + ' — ' + `<a href="${out.url}" download="${out.name}.` + (format.value.split('/')[1]||'webp') + `">Download</a>` + `<div><img class='thumb' src='${out.url}'/></div>`; 
            comp.appendChild(row); 
          }
          setStatus('Done'); 
        } catch(e) {
          setStatus('Error compressing images: ' + e.message);
        }
      }

      async function downloadZip(){ if(!outputs.length) return; // simple zip via Data URLs (no external libs): generate a minimal .zip is complex; instead, open downloads one by one
        for(const o of outputs){ const a=document.createElement('a'); a.href=o.url; a.download=`${o.name}.`+(format.value.split('/')[1]||'webp'); a.click(); await new Promise(r=> setTimeout(r, 100)); }
      }

      files.addEventListener('change', ()=>{ previewOriginals(); comp.innerHTML=''; outputs=[]; setStatus(''); });
      processBtn.addEventListener('click', compressAll);
      downloadAll.addEventListener('click', downloadZip);
    })();
  </script>
</body>
</html>
